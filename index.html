<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon 服务测试</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .service-section { margin-bottom: 30px; padding: 15px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .service-section h2 { margin-top: 0; color: #0056b3; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .site-list { list-style: none; padding: 0; }
        .site-list li { display: flex; align-items: center; margin-bottom: 10px; padding: 8px; border-bottom: 1px solid #f0f0f0; }
        .site-list li:last-child { border-bottom: none; }
        .site-list img { width: 32px; height: 32px; margin-right: 10px; border: 1px solid #eee; background-color: #f9f9f9; }
        .site-list .status { margin-left: auto; font-size: 0.9em; }
        .status.ok { color: green; }
        .status.error { color: red; }
        .site-name { font-weight: bold; }
        .site-url { font-size: 0.8em; color: #555; word-break: break-all; }
    </style>
</head>
<body>
    <h1>Favicon 服务可用性测试</h1>
    <p>请分别在开启和关闭VPN的情况下观察以下图标的加载情况。</p>

    <div id="results">
        </div>

    <script>
        const testSites = [
            { name: "百度", url: "https://www.baidu.com" },
            { name: "淘宝", url: "https://www.taobao.com" },
            { name: "腾讯", url: "https://www.qq.com" },
            { name: "GitHub", url: "https://github.com" },
            { name: "Google", url: "https://www.google.com" }, // 可能需要VPN
            { name: "Apple", url: "https://www.apple.com" }
        ];

        const faviconServices = [
            {
                name: "Google S2 Favicon",
                getUrl: (siteUrlFull, domain) => `https://www.google.com/s2/favicons?sz=32&domain_url=${encodeURIComponent(siteUrlFull)}`
            },
            {
                name: "DuckDuckGo Favicon (ip3)",
                getUrl: (siteUrlFull, domain) => `https://icons.duckduckgo.com/ip3/${domain}.ico`
            },
            {
                name: "Favicon Kit",
                getUrl: (siteUrlFull, domain) => `https://api.faviconkit.com/${domain}/32`
            },
            {
                name: "icon.horse (Clearbit)",
                getUrl: (siteUrlFull, domain) => `https://icon.horse/icon/${domain}` // 默认尺寸可能较大，但会自动调整
            },
            {
                name: "Yandex Favicon",
                getUrl: (siteUrlFull, domain) => `https://favicon.yandex.net/favicon/v2/${domain}?size=32&stub=1` // v2 API
            }
        ];

        const resultsContainer = document.getElementById('results');

        faviconServices.forEach(service => {
            const serviceSection = document.createElement('div');
            serviceSection.className = 'service-section';
            
            const title = document.createElement('h2');
            title.textContent = service.name;
            serviceSection.appendChild(title);

            const siteList = document.createElement('ul');
            siteList.className = 'site-list';

            testSites.forEach(site => {
                const listItem = document.createElement('li');
                
                const img = document.createElement('img');
                let domain = '';
                try {
                    const urlObj = new URL(site.url);
                    domain = urlObj.hostname.replace(/^www\./, '');
                } catch (e) {
                    console.error(`无法解析URL: ${site.url}`, e);
                    domain = site.url.replace(/^https?:\/\//, '').split('/')[0].replace(/^www\./, ''); // 简易回退
                }

                const faviconUrl = service.getUrl(site.url, domain);
                img.src = faviconUrl;
                img.alt = `${site.name} icon`;
                
                const siteInfo = document.createElement('div');
                const siteNameSpan = document.createElement('span');
                siteNameSpan.className = 'site-name';
                siteNameSpan.textContent = site.name;
                const siteUrlSpan = document.createElement('div');
                siteUrlSpan.className = 'site-url';
                siteUrlSpan.textContent = site.url;
                siteInfo.appendChild(siteNameSpan);
                siteInfo.appendChild(siteUrlSpan);

                const statusSpan = document.createElement('span');
                statusSpan.className = 'status';
                statusSpan.textContent = '加载中...';

                img.onload = function() {
                    statusSpan.textContent = '成功';
                    statusSpan.className = 'status ok';
                };
                img.onerror = function() {
                    statusSpan.textContent = '失败';
                    statusSpan.className = 'status error';
                    img.style.visibility = 'hidden'; // 或者显示一个通用占位符
                    console.warn(`加载失败 (${service.name}): ${faviconUrl}`);
                };
                
                listItem.appendChild(img);
                listItem.appendChild(siteInfo);
                listItem.appendChild(statusSpan);
                siteList.appendChild(listItem);
            });
            serviceSection.appendChild(siteList);
            resultsContainer.appendChild(serviceSection);
        });
    </script>
</body>
</html>